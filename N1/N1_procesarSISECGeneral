/**
 * Procesa los periodos laborales en SISEC GENERAL.
 * Nivel N1
 */
function N1_procesarSISECGeneral(patrones) {
  let periodos = [];

  patrones.forEach(patron => {
    let fechaAlta = patron.alta;
    let fechaBaja = patron.baja;
    let salario = patron.salario;

    // Validar que fechaBaja no sea undefined antes de usar toUpperCase()
    if (fechaBaja && typeof fechaBaja === "string" && fechaBaja.toUpperCase() === "VIGENTE") {
      fechaBaja = N1_obtenerUltimoDiaMes();
    }

    // Agregar el perÃ­odo a la lista
    periodos.push({
      patron: patron.nombre,
      alta: fechaAlta,
      baja: fechaBaja,
      salario: salario
    });
  });

  // Ordenar de mÃ¡s reciente a mÃ¡s antiguo
  periodos.sort((a, b) => new Date(b.baja.split("/").reverse().join("-")) - new Date(a.baja.split("/").reverse().join("-")));

  Logger.log("ðŸ“Œ PerÃ­odos procesados (SISEC GENERAL): " + JSON.stringify(periodos));

  return periodos;
}

/**
 * Obtiene el Ãºltimo dÃ­a del mes actual (helper de fechas para N1).
 */
function N1_obtenerUltimoDiaMes() {
  let hoy = new Date();
  let ultimoDia = new Date(hoy.getFullYear(), hoy.getMonth() + 1, 0);
  return Utilities.formatDate(ultimoDia, Session.getScriptTimeZone(), "dd/MM/yyyy");
}
